# ESP32-C3 Mini configuration

CONFIG_IDF_TARGET_ESP32C3=y
CONFIG_IDF_TARGET="esp32c3"

# Geogram board selection
CONFIG_GEOGRAM_BOARD_ESP32C3_MINI=y

# Flash
CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y

# CPU frequency (160MHz for ESP32-C3)
CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_160=y
CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ=160

# No PSRAM on ESP32-C3 mini
# CONFIG_SPIRAM is not set

# WiFi - reduced buffer sizes for limited RAM (400KB SRAM)
CONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=6
CONFIG_ESP32_WIFI_DYNAMIC_RX_BUFFER_NUM=16
CONFIG_ESP32_WIFI_TX_BUFFER_TYPE=1
CONFIG_ESP32_WIFI_DYNAMIC_TX_BUFFER_NUM=16

# Reduce memory usage
CONFIG_ESP_SYSTEM_EVENT_TASK_STACK_SIZE=3072
CONFIG_ESP_MAIN_TASK_STACK_SIZE=4096

# Increase Timer Service task stack for ESP-Mesh-Lite callbacks
# Default 2048 is too small - mesh-lite timer callbacks cause stack overflow
# 4096 still overflows when phone connects, try 6144
CONFIG_FREERTOS_TIMER_TASK_STACK_DEPTH=6144

# ============================================================================
# ESP-Mesh-Lite Configuration
# ============================================================================

# LWIP settings required for mesh-lite
CONFIG_LWIP_IP_FORWARD=y
CONFIG_LWIP_IPV4_NAPT=y
CONFIG_LWIP_NETIF_API=y

# Bridge configuration
CONFIG_BRIDGE_ENABLE=y
CONFIG_BRIDGE_DATA_FORWARDING_NETIF_SOFTAP=y
CONFIG_BRIDGE_EXTERNAL_NETIF_STATION=y
# SSID for phone/laptop connectivity
# All nodes use same SSID "geogram" for phone auto-connect
# Mesh discovery uses vendor IEs, not SSID matching
CONFIG_BRIDGE_SOFTAP_SSID="geogram"
CONFIG_BRIDGE_SOFTAP_PASSWORD=""
# CONFIG_BRIDGE_SOFTAP_SSID_END_WITH_THE_MAC is not set
CONFIG_BRIDGE_SOFTAP_MAX_CONNECT_NUMBER=4
CONFIG_BRIDGE_ETHERNET_NETIF_ENABLE=n

# DNS server for captive portal - clients use ESP32 as DNS server
# This enables the captive portal to intercept all domain queries
CONFIG_BRIDGE_STATIC_DNS_SERVER_MAIN="192.168.5.1"

# Mesh-Lite settings
CONFIG_MESH_LITE_ENABLE=y

# Enable Geogram mesh networking
CONFIG_GEOGRAM_MESH_ENABLED=y
# Vendor ID: 'G' (71), 'W' (87) - "GW" for Geogram Wireless
CONFIG_MESH_LITE_VENDOR_ID_0=71
CONFIG_MESH_LITE_VENDOR_ID_1=87
# Mesh ID: 'g' (103) - matches mesh_id[0] in code ('g','e','o','m','s','h')
CONFIG_MESH_LITE_ID=103
CONFIG_MESH_LITE_MAX_ROUTER_NUMBER=3
CONFIG_MESH_LITE_MAXIMUM_LEVEL_ALLOWED=3
CONFIG_JOIN_MESH_WITHOUT_CONFIGURED_WIFI_INFO=y
CONFIG_JOIN_MESH_IGNORE_ROUTER_STATUS=y
CONFIG_DEVICE_CATEGORY="Geogram"
CONFIG_LEAF_NODE=n
CONFIG_MESH_LITE_NODE_INFO_REPORT=y
