; =============================================================================
; Geogram ESP32 Multi-Board Project
; PlatformIO Configuration
; =============================================================================

[platformio]
default_envs = esp32s3_epaper_1in54
src_dir = src
include_dir = include

; =============================================================================
; Common settings for all ESP-IDF environments
; =============================================================================
[env]
framework = espidf
monitor_speed = 115200
upload_speed = 115200
build_flags =
    -DGEOGRAM_VERSION=\"1.0.0\"
    -Iinclude

; =============================================================================
; ESP32-S3 ePaper 1.54" (Waveshare) - Full Implementation
; =============================================================================
[env:esp32s3_epaper_1in54]
platform = espressif32@6.7.0
board = esp32-s3-devkitc-1
board_build.partitions = partitions.csv
board_build.flash_mode = qio
board_build.f_flash = 80000000L
board_upload.flash_size = 4MB

; ESP32-S3 specific settings
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; Use built-in JTAG for more reliable uploads
upload_protocol = esp-builtin

; Build flags with include paths for ESP-IDF driver components and local components
build_flags =
    ${env.build_flags}
    -DBOARD_MODEL=MODEL_ESP32S3_EPAPER_1IN54
    -DBOARD_NAME=\"ESP32S3-ePaper-1.54\"
    -DHAS_EPAPER_DISPLAY=1
    -DHAS_RTC=1
    -DHAS_HUMIDITY_SENSOR=1
    -DHAS_PSRAM=1
    ; ESP-IDF driver includes
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/spi/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/gpio/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/i2c/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/deprecated
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/heap/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/nvs_flash/include
    ; Local component includes (for cross-component dependencies)
    -Icomponents/geogram_epaper_1in54
    -Icomponents/geogram_shtc3
    -Icomponents/geogram_pcf85063
    -Icomponents/geogram_i2c
    -Icomponents/geogram_i2c/include
    -Icomponents/geogram_lvgl
    -Icomponents/geogram_ui
    -Icomponents/geogram_wifi
    -Icomponents/geogram_wifi/include
    -Icomponents/geogram_http
    -Icomponents/geogram_model_epaper_1in54
    -Icomponents/geogram_button
    -Icomponents/geogram_common/include
    ; Station API components
    -Icomponents/geogram_station
    -Icomponents/geogram_json
    -Icomponents/geogram_ws
    -Icomponents/geogram_nostr
    ; Serial console, telnet, SSH, DNS, and geolocation
    -Icomponents/geogram_console
    -Icomponents/geogram_telnet
    -Icomponents/geogram_ssh
    -Icomponents/geogram_dns
    -Icomponents/geogram_geoloc
    ; SD card, tiles, and updates support
    -Icomponents/geogram_sdcard
    -Icomponents/geogram_tiles
    -Icomponents/geogram_updates
    ; Mesh networking support
    -Icomponents/geogram_mesh
    -Icomponents/geogram_mesh/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/fatfs/vfs
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/fatfs/src
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/sdmmc/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/vfs/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/sdmmc/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/wear_levelling/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/esp_partition/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/spi_flash/include
    ; LVGL include
    -Imanaged_components/lvgl__lvgl
    -Imanaged_components/lvgl__lvgl/src

; Firmware output naming
extra_scripts =
    pre:scripts/pre_build.py
    post:scripts/post_build.py

; Custom firmware name
custom_firmware_name = geogram-ESP32S3-ePaper1in54

; =============================================================================
; Generic ESP32 - Skeleton (no display)
; =============================================================================
[env:esp32_generic]
platform = espressif32@6.7.0
board = esp32dev
board_build.partitions = partitions.csv

board_build.mcu = esp32
board_build.f_cpu = 240000000L

build_flags =
    ${env.build_flags}
    -DBOARD_MODEL=MODEL_ESP32_GENERIC
    -DBOARD_NAME=\"ESP32-Generic\"
    -DHAS_DISPLAY=0

custom_firmware_name = geogram-ESP32-Generic

extra_scripts =
    pre:scripts/pre_build.py
    post:scripts/post_build.py

; =============================================================================
; ESP32-C3 Mini - Minimal board (WiFi + BLE, no display/peripherals)
; =============================================================================
[env:esp32c3_mini]
platform = espressif32@6.7.0
board = esp32-c3-devkitm-1
board_build.partitions = partitions.csv

; ESP32-C3 specific settings
board_build.mcu = esp32c3
board_build.f_cpu = 160000000L

build_flags =
    ${env.build_flags}
    -DBOARD_MODEL=MODEL_ESP32C3_MINI
    -DBOARD_NAME=\"ESP32-C3-mini\"
    -DHAS_DISPLAY=0
    -DHAS_EPAPER_DISPLAY=0
    -DHAS_RTC=0
    -DHAS_HUMIDITY_SENSOR=0
    -DHAS_PSRAM=0
    -DHAS_SDCARD=0
    ; Linker flag to resolve pthread multiple definitions from esp_modem/iot_bridge
    -Wl,--allow-multiple-definition
    ; ESP-IDF driver includes
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/gpio/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/driver/i2c/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/heap/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/nvs_flash/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/esp_partition/include
    -I$PROJECT_PACKAGES_DIR/framework-espidf/components/spi_flash/include
    ; Local component includes
    -Icomponents/geogram_model_esp32c3_mini
    -Icomponents/geogram_wifi
    -Icomponents/geogram_wifi/include
    -Icomponents/geogram_http
    -Icomponents/geogram_console
    -Icomponents/geogram_telnet
    -Icomponents/geogram_common/include
    ; Mesh networking support
    -Icomponents/geogram_mesh
    -Icomponents/geogram_mesh/include

custom_firmware_name = geogram-ESP32C3-mini

extra_scripts =
    pre:scripts/pre_build.py
    post:scripts/post_build.py
